html {
    font-size: 14px;
    position: relative;
    min-height: 100%;
}

@media (min-width: 768px) {
  html {
    font-size: 16px;
  }
}

.btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
  box-shadow: 0 0 0 0.1rem white, 0 0 0 0.25rem #258cfb;
}

body {
  margin-bottom: 60px;
}

.form-floating > .form-control-plaintext::placeholder, .form-floating > .form-control::placeholder {
  color: var(--bs-secondary-color);
  text-align: end;
}

.form-floating > .form-control-plaintext:focus::placeholder, .form-floating > .form-control:focus::placeholder {
  text-align: start;
}

/* カスタムスタイルここから */
:root {
    --gap: 12px;
    --card: 14px;
}

.layout {
    display: grid;
    grid-template-columns: 1.05fr 0.95fr;
    gap: 16px;
    align-items: start;
}

@media (max-width: 980px) {
    .layout {
        grid-template-columns: 1fr;
    }
}

.field {
    display: grid;
    grid-template-columns: 140px 1fr;
    gap: 10px;
    align-items: center;
}

@media (max-width: 520px) {
    .field {
        grid-template-columns: 1fr;
    }

    .two-col {
        grid-template-columns: 1fr;
    }
}




.label {
    font-weight: 600;
}

.control {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

    .control input, .control select {
        padding: 6px 8px;
        min-height: 34px;
        border: 1px solid #ccc;
        border-radius: 8px;
    }

.unit {
    color: #444;
}

.two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

@media (max-width: 520px) {
    .two-col {
        grid-template-columns: 1fr;
    }
}

.kv {
    display: grid;
    /* タイトル列は細め固定、値側に幅を返す */
    grid-template-columns: 8.5em minmax(0, 1fr);
    gap: 8px 12px;
    align-items: baseline;
    margin: 0;
}

    .kv dt {
        white-space: nowrap;
    }
    /* タイトルは原則1行に */
    .kv dd {
        min-width: 0;
    }
/* 値側をちゃんと折り返させるため */

@media (max-width: 520px) {
    /* 画面が狭い時は dt/dd を縦並び（タイトル折り返し問題も、内訳の圧縮も両方解消） */
    .kv {
        grid-template-columns: 1fr;
    }

        .kv dt {
            white-space: normal;
        }
}

.pill {
    display: inline-block;
    padding: 2px 8px;
    border: 1px solid #ddd;
    border-radius: 999px;
    font-size: 0.85em;
    color: #333;
    background: #fafafa;
}


details > summary {
    cursor: pointer;
}

details summary {
    font-weight: 600;
}


/* 補助説明：カード風 */
.hr {
    border-top: 1px solid #eee;
    margin: 12px 0;
}

.small {
    font-size: 0.92em;
}

.muted {
    color: #666;
}

.field.sub {
    padding: 8px 10px;
    border-radius: 10px;
    background: #f7f7f7;
    border: 1px solid #e7e7e7;
}

    /* 肝性脳症チェック表示用 */
    .field.sub .label {
        position: relative;
        padding-left: 10px;
    }

        .field.sub .label::before {
            content: "";
            position: absolute;
            left: 0;
            top: 2px;
            bottom: 2px;
            width: 3px;
            border-radius: 2px;
            background: #d6d6d6;
        }

/* エラースタイル */
.text-danger {
    color: #b00020;
}

.validation-summary {
    margin: 8px 0 0 0;
}

.field-error {
    margin-top: 4px;
    font-size: 0.9em;
}

/* ストレス係数合計・内訳表示用 */
.pills {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 6px;
    align-items: center;
}

.pill.mini {
    font-size: 0.82em;
    padding: 1px 6px;
}

/* mini pill は全体で統一して小さめに */
.pill.mini {
    font-size: 0.70em;
    line-height: 1.2;
    padding: 1px 6px;
}

/* 要点欄の pill を“塊”として扱う */
.value-tail {
    display: inline-block;
    white-space: nowrap;
    margin-left: .35em; /* 任意：数値との間隔 */
}


/* ストレス合計・必要エネルギーの折り返し調整 */
.kv dd .mainline {
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-wrap: wrap; /* ここで折り返し＝1行に収まらない場合のみ */
}

.kv dd .subline {
    margin-top: 6px;
}
/* 1行に収める：右にはみ出したら横スクロール（縦は増やさない） */
.line {
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-wrap: nowrap;
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 2px; /* スクロールバーが被らないように */
}

    .line::-webkit-scrollbar {
        height: 6px;
    }
/* 任意：スクロールバー薄く */

.kv-need {
    grid-template-columns: 7.5em minmax(0, 1fr);
}

    .kv-need dd {
        min-width: 0;
    }

/* ストレス合計の内訳表示用 */
.need-line {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: baseline;
}

    .need-line + .need-line {
        margin-top: 6px;
    }

/* BMR計算式名pill表示用 */
.pill.trunc {
    max-width: 10.5em; /* ここを調整：狭いなら9em、余裕あるなら12em */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* 基本入力に注釈を追加 */
.section-head {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 10px;
    margin: 0 0 8px 0;
}

    .section-head h3 {
        margin: 0;
    }

.section-meta {
    font-size: .85em;
    color: #667;
    white-space: nowrap;
}

@media (max-width: 520px) {
    .section-head {
        flex-direction: column;
        align-items: flex-start;
    }

    .section-meta {
        white-space: normal;
    }
}


/* 経腸栄養セクション：計算結果＋割付候補 */
.enteral-top {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 計算結果 | 割付候補 */
    gap: 10px 14px;
    align-items: start;
}

.enteral-box h4 {
    margin: 6px 0 6px;
}

.compact-list {
    margin: 0;
    padding-left: 1.1em;
}

    .compact-list li {
        margin: 2px 0;
    }

/* 狭い画面は縦に戻す */
@media (max-width: 520px) {
    .enteral-top {
        grid-template-columns: 1fr;
    }
}

/* 文字を詰める */
.kv.kv-tight {
    margin-top: 0;
}

/* エネルギー候補（参照）2列化  */
.kv.kv-2col-energy {
    display: grid;
    grid-template-columns: 8em 1fr 8em 1fr;
    column-gap: 10px;
    row-gap: 6px;
}

@media (max-width: 520px) {
    .kv.kv-2col-energy {
        grid-template-columns: 9em 1fr;
    }
}

/* === IE11フォールバック：kv-2col-energy を2列（dt/dd + dt/dd）にする === */
.kv.kv-2col-energy {
    margin: 0;
}

    /* 1つ目のdt（1,5,9...） */
    .kv.kv-2col-energy dt:nth-of-type(odd) {
        float: left;
        clear: left;
        width: 10em;
        margin: 0;
        padding: 0;
    }

    /* 1つ目のdd（1,5,9...） */
    .kv.kv-2col-energy dd:nth-of-type(odd) {
        float: left;
        width: calc(50% - 10em); /* ← dt幅と一致 */
        padding-right: 10px; /* gap代替（左右の間隔） */
        box-sizing: border-box;
        margin: 0;
        padding-top: 0;
        padding-bottom: 0;
    }

    /* 2つ目のdt（2,6,10...） */
    .kv.kv-2col-energy dt:nth-of-type(even) {
        float: left;
        width: 10em;
        margin: 0;
        padding: 0;
    }

    /* 2つ目のdd（2,6,10...） */
    .kv.kv-2col-energy dd:nth-of-type(even) {
        float: left;
        width: calc(50% - 10em); /* ← dt幅と一致 */
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
        
    /* floatの後始末 */
    .kv.kv-2col-energy::after {
        content: "";
        display: block;
        clear: both;
    }

/* === モダンだけ grid に戻す（院外Edge/スマホ維持） === */
@supports (display: grid) {
    .kv.kv-2col-energy {
        display: grid;
        grid-template-columns: 8em minmax(0, 1fr) 8em minmax(0, 1fr);
        column-gap: 10px;
        row-gap: 6px;
    }
        /* IE用floatの解除（←これは残す） */
        .kv.kv-2col-energy dt,
        .kv.kv-2col-energy dd {
            float: none;
            clear: none; /* 念のため */
            width: auto;
            margin: 0;
            padding: 0;
            /* 今回効いたやつ（←これを追加して残す） */
            min-width: 0;
        }
        /* -kcal を守る */
        .kv.kv-2col-energy dd {
            white-space: nowrap;
        }

        .kv.kv-2col-energy::after {
            content: none;
            display: none;
            clear: none;
        }

    @media (max-width: 520px) {
        .kv.kv-2col-energy {
            grid-template-columns: 9em minmax(0, 1fr);
        }
    }
}

   
    /* === IE11フォールバック（デフォルト） === */
    .layout {
        display: flex;
        align-items: flex-start;
    }

        .layout > .main {
            flex: 0 0 52.5%;
            margin-right: 16px; /* gap 代替 */
            min-width: 0;
        }
    
        .layout > .summary {
            flex: 1 1 auto;
            min-width: 0;
        }

    /* === IE11でも画面が狭いときは1段積みにする === */
    @media (max-width: 980px) {
    .layout {
        flex-direction: column;
    }

        .layout > .main {
            flex: 0 0 auto;
            margin-right: 0; /* 横並び用の余白を消す */
            width: 100%;
        }

        .layout > .summary {
            flex: 0 0 auto;
            width: 100%;
            margin-top: 4px; /* IE11では少しmargin-topを設ける */
        }
    }

    /* デフォルトは sticky を使わず安全側（IE含む） */
    .summary {
        position: static;
    }
    /* === モダン（Edge/スマホ）だけ grid + sticky + スマホ挙動 === */
    @supports (display: grid) {
    /* IE用 margin-top をモダンでは無効化（タブレット帯は後の@mediaで上書きされる） */
    .layout > .summary {
        margin-top: 0;
    }

    /* 2カラム(grid)の基本 */
    .layout {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        gap: 12px;
        align-items: start;
    }
    /* 右カラムを見やすく（PC幅では sticky） */
    .summary {
        position: sticky;
        top: 12px;
    }
    /* スマホ(～720)：1カラムに */
    @media (max-width: 720px) {
        .layout {
            grid-template-columns: 1fr;
            gap: 0px;
        }
        /* スマホは sticky を解除して自然に下へ */
        .summary {
            position: static;
            margin-top: 0px; /* スマホ時のsummary top marginを削る */
        }
        /* 結果（参照）の2カラムをスマホで縦にする（モダンのみ） */
        .two-col {
            display: block;
        }

            .two-col > div {
                margin-top: 10px;
            }

                .two-col > div:first-child {
                    margin-top: 0;
                }
    }
    /* タブレット(721px〜980px)：右カラムを下げたい（スマホ720以下とは競合させない） */
    @media (min-width: 721px) and (max-width: 980px) {
        .summary {
            margin-top: 24px;
            position: static; /* タブレット帯はstickyを止めたいなら */
        }
    }
}
    /* 経腸栄養：スマホで「成分・割付候補」を折りたたみ */
    .enteral-details {
        margin-top: 10px;
    }

        .enteral-details > summary {
            list-style: none;
            cursor: pointer;
            font-weight: 600;
            padding: 6px 0;
        }
            /* Safari用：summaryのマーカー調整（任意） */
            .enteral-details > summary::-webkit-details-marker {
                display: none;
            }
    /* PCでは常時展開（summaryは非表示） */
    @media (min-width: 981px) {
        .enteral-details > summary {
            display: none;
        }

        .enteral-details {
            /* 常時見せたいので見た目を自然に */
            margin-top: 0;
        }
    }
    /* スマホでは初期は閉じてもOK：openを外したいならここで制御も可能 */
    @media (max-width: 980px) {
        .enteral-details[open] > summary {
            margin-bottom: 6px;
        }
    }
    /* スマホでは経腸栄養カードを弱く見せる　*/
    @media (max-width: 980px) {
        .summary .card {
            opacity: 0.95;
        }

            .summary .card h3 {
                font-size: 1rem;
            }
    }
    
    /* 右カラム先頭「要点」3点レイアウト */
    /* === 共通/IE11向け：要点( hero3 ) はflex === */
    .hero3 {
        display: flex;
        flex-wrap: wrap; /* 狭ければ折り返す */
        margin-top: 8px;
}

    /* IE11は gap 非対応なので代替（子に余白） */
    .hero3 > .hero3-item {
        margin-right: 8px;
        margin-bottom: 8px;
        flex: 1 1 30%;
        min-width: 150px; /* 140〜180で好み */
    }

        .hero3 > .hero3-item:last-child {
            margin-right: 0;
        }

    .hero3-label {
        font-size: 0.78rem;
        opacity: 0.75;
        margin-bottom: 4px;
        line-height: 1.1;
    }

    /* 要点ラベル内の単位（(g) (mL) (mL/min)） */
    .label-unit {
        font-size: 0.85em;
        opacity: 0.8;
        margin-left: .15em;
        white-space: nowrap; /* (mL/min) が割れない */
    }

    .hero3-value {
        display: flex;
        align-items: baseline;
        gap: 6px; /* IE11では効かないが害はない */
        flex-wrap: wrap;
        line-height: 1.1;
        min-width: 0; /* ★狭い時のはみ出し保険 */
        white-space: normal; /* ★nowrap打ち消し保険 */
    }

    .hero3-value strong {
        font-size: 1.22em;
        white-space: nowrap; /* ★数値は分断しない */
    }

    
    /* ★単位+pillを“1塊”にして、入らなければ丸ごと次行へ */
    .value-tail {
        display: inline-flex; /* ★塊化 */
        align-items: baseline;
        gap: 6px;
        white-space: nowrap; /* 塊の中は折らない */
        flex: 0 0 auto;
        margin-left: .35em;
    }
/* === モダンだけ：gridで自動列 === */
@supports (display: grid) {
    .hero3 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(128px, 1fr));
        gap: 8px;
        margin-top: 8px;
    }
        /* grid時は IE用 margin を無効化 */
        .hero3 > .hero3-item {
            margin-right: 0;
            margin-bottom: 0;
            min-width: 0;
        }
}

/* かなり狭い端末だけ少し圧縮（モダンのみ適用） */
@media (max-width: 430px) {
    @supports (display: grid) {
        .hero3 {
            gap: 6px;
        }

        .hero3-label {
            margin-bottom: 2px;
        }
    }
}


    /* 結果をボタンっぽく　*/
    .result-details > summary {
        cursor: pointer;
        font-weight: 600;
        padding: 6px 0;
        list-style: none;
    }

        .result-details > summary::-webkit-details-marker {
            display: none;
        }

    /* PCでは常時表示（折りたたみ不要）  */
    @media (min-width: 981px) {
        .result-details > summary {
            display: none;
        }
    }
    /* PCでは要点（スマホ専用）を非表示 */
    @media (min-width: 981px) {
        .summary-hero {
            display: none !important;
        }
    }

    .calc-actions {
        display: none;
    }
    /* スマホ初回のみの案内 */
    @media (max-width: 980px) {
        .homehint--dismissible {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 10px 12px;
            margin: 0 0 10px 0;
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 12px;
            background: rgba(0,0,0,0.02);
            font-size: 0.9rem;
            line-height: 1.35;
        }

        .homehint-text {
            flex: 1;
            min-width: 0;
        }

        .homehint-close {
            border: 0;
            background: transparent;
            font-size: 1.2rem;
            line-height: 1;
            padding: 0 4px;
            cursor: pointer;
            opacity: 0.7;
        }

            .homehint-close:active {
                opacity: 1;
            }
    }

    @media (max-width: 980px) {
        /* ラベル + コントロールは2列 */
        .field-compact {
            display: grid;
            grid-template-columns: 6em 1fr;
            gap: 8px;
            align-items: start; /* エラー行が出ても崩れない */
        }
            /* 右側を flex で1行固定 */
            .field-compact .control {
                display: flex;
                align-items: center;
                flex-wrap: wrap; /* ← エラーだけ下に落とすため wrap */
                gap: 6px;
                min-width: 0;
            }
                /* input は必要分だけ伸びる（unitの分を残す） */
                .field-compact .control input[type="number"],
                .field-compact .control input[type="text"] {
                    flex: 1 1 8ch; /* ← 伸びるが最低幅を確保 */
                    width: auto;
                    min-width: 0;
                }
                /* unit は折り返さない・横に固定 */
                .field-compact .control .unit {
                    flex: 0 0 auto;
                    white-space: nowrap;
                }
                /* エラー表示は必ず次の行へ（横幅いっぱい） */
                .field-compact .control .field-error {
                    flex: 0 0 100%;
                    margin-top: 2px;
                }
                /* select は100%でOK（unit無し） */
                .field-compact .control select {
                    width: 100%;
                }
    }

    @media (max-width: 980px) {
        /* 1行維持のまま、入力欄の最大幅を制限（PCに近い見た目） */
        .field-compact .control input[type="number"],
        .field-compact .control input[type="text"] {
            max-width: 12rem; /* ← ここを好みで調整（例：10rem〜14rem） */
        }
    }

    @media (max-width: 980px) {
        /* 性別・疾患など select もPCっぽい幅で頭打ち */
        .field-compact .control select {
            width: auto; /* 100%を解除 */
            flex: 0 0 auto;
            max-width: 14rem; /* 好みで調整（例：12rem〜16rem） */
        }
    }
    /* 必要エネルギー値強調表示：要点の数値と同じ大きさに揃える */
    #EnergyOrderValue {
        font-weight: 700;
        font-size: 1.22em; /* ← hero3-value strong と同じ */
        line-height: 1.1; /* 要点と揃えておくと高さが安定 */
    }
    /* 経腸栄養量強調表示：必要エネルギーと同じ大きさに揃える */
    #EnteralVolumeInput {
        font-weight: 700;
        font-size: 1.22em;
        line-height: 1.1;
    }


    @media (max-width: 980px) {
        /* 基本：③ ラベル列を少し広げる（折り返しを減らす） */
        .field-compact {
            grid-template-columns: 7.5em 1fr;
        }
    }
    /* さらに狭い端末だけ：② 省略表示で入力欄を守る */
    @media (max-width: 360px) {
        .field-compact .label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    }
    /* ストレス係数・体温補正・褥瘡：基本は“広め”だが、枠からはみ出さない */
    .field-compact .control select.sel-wide {
        max-width: 100%; /* これが最重要：常に枠内 */
    }
    /* 広い画面では見やすいように上限を設ける（好みで調整） */
    @media (min-width: 981px) {
        .field-compact .control select.sel-wide {
            max-width: 20rem; /* 好みで 16〜20rem */
        }
    }

    .field-compact .control {
        min-width: 0;
    }
    /* === IE11フォールバック：項目(ラベル)と入力を1行にする === */
    .field {
        display: flex;
        align-items: center;
    }

        .field > label,
        .field > .label {
            flex: 0 0 140px; /* ここは今のUIに合わせて調整可 */
            margin-right: 10px; /* gap代替 */
            white-space: nowrap; /* ラベル折り返し防止（必要なら外す） */
        }

        .field > .control,
        .field > input,
        .field > select,
        .field > textarea {
            flex: 1 1 auto;
            min-width: 0;
        }
    /* モダンだけ grid に戻す */
    @supports (display: grid) {
        .field {
            display: grid;
            grid-template-columns: 140px 1fr;
            gap: 10px;
            align-items: center;
        }

            .field > label,
            .field > .label {
                margin-right: 0;
                white-space: normal;
            }
    }
    /* === IE11フォールバック：two-col を2列にする === */
    .two-col {
        display: flex;
    }

        .two-col > div {
            flex: 1 1 0;
            min-width: 0;
        }

            .two-col > div + div {
                margin-left: 10px; /* gap代替 */
            }
    /* モダンだけ grid */
    @supports (display: grid) {
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

            .two-col > div + div {
                margin-left: 0;
            }
    }
    /* ✅ スマホは1列に戻す（モダンのみ） */
    @media (max-width: 720px) {
        .two-col {
            display: block; /* 以前の挙動を復活 */
        }

            .two-col > div {
                margin-top: 10px;
            }

                .two-col > div:first-child {
                    margin-top: 0;
                }
    }
    /* === IE11フォールバック：kv-need を「dt左 / dd右」で1行×複数行にする === */
    .kv.kv-need {
        margin: 0;
    }
        /* IE11: kv-need の dt は2行まで許可、pill は必ず次行 */
        .kv.kv-need dt {
            line-height: 1.25;
        }
            /* pill は必ずブロック化して別行に */
            .kv.kv-need dt .pills {
                display: block;
                margin-top: 2px;
            }
        /* dt を左に固定して、次の行へ送る */
        .kv.kv-need dt {
            float: left;
            clear: left; /* ← これで「各dtが必ず新しい行から」始まる */
            width: 8.5em; /* ← 左列幅（grid時と合わせる） */
            margin: 0;
            padding: 0;
            white-space: normal; /* pills等があるので折り返し許可（nowrapにすると溢れやすい） */
        }
        /* dd は右側に配置（dtの幅だけ左マージン） */
        .kv.kv-need dd {
            margin: 0 0 6px 8.5em; /* ← 左にdt幅ぶん空ける。下マージンは好みで */
            padding: 0;
            min-width: 0;
        }
        /* dl 内の float を閉じる（カードの崩れ防止） */
        .kv.kv-need::after {
            content: "";
            display: block;
            clear: both;
        }
    /* === モダンだけ grid に戻す（院外Edge/スマホ維持） === */
    @supports (display: grid) {
        .kv.kv-need {
            display: grid;
            grid-template-columns: 9em minmax(0, 1fr);
            gap: 8px 12px;
            align-items: baseline;
        }

            .kv.kv-need dt,
            .kv.kv-need dd {
                float: none;
                clear: none;
                width: auto;
                margin: 0;
            }

            .kv.kv-need::after {
                content: none;
                display: none;
                clear: none;
            }
    }
    /* === IE11フォールバック：計算結果｜割付候補 を2列 === */
    .enteral-top {
        display: flex;
        align-items: flex-start;
    }

        .enteral-top > .enteral-box {
            flex: 1 1 0;
            min-width: 0;
        }

            .enteral-top > .enteral-box + .enteral-box {
                margin-left: 14px; /* gap代替（好みで） */
            }
    /* === モダンだけ grid（院外Edge/スマホ維持） === */
    @supports (display: grid) {
        .enteral-top {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 計算結果 | 割付候補 */
            gap: 10px 14px;
            align-items: start;
        }

            .enteral-top > .enteral-box + .enteral-box {
                margin-left: 0;
            }
        /* スマホは縦積み */
        @media (max-width: 520px) {
            .enteral-top {
                grid-template-columns: 1fr;
            }
        }
    }
    /* === IE11フォールバック：kv-2col（dt dd dt dd）を2分割 === */
    .kv.kv-2col {
        margin: 0;
    }

        .kv.kv-2col dt,
        .kv.kv-2col dd {
            float: left;
            margin: 0;
            padding: 0;
            min-width: 0;
        }
            /* 左側 dt */
            .kv.kv-2col dt:nth-of-type(odd) {
                clear: left;
                width: 8.5em; /* ここは好みで（9emなど） */
            }
            /* 左側 dd */
            .kv.kv-2col dd:nth-of-type(odd) {
                width: calc(50% - 8.5em);
                padding-right: 10px;
                box-sizing: border-box;
            }
            /* 右側 dt */
            .kv.kv-2col dt:nth-of-type(even) {
                width: 8.5em;
            }
            /* 右側 dd */
            .kv.kv-2col dd:nth-of-type(even) {
                width: calc(50% - 8.5em);
                box-sizing: border-box;
            }
        /* floatの後始末 */
        .kv.kv-2col::after {
            content: "";
            display: block;
            clear: both;
        }
    /* === モダンだけ grid に戻す（float解除もここで行う） === */
    @supports (display: grid) {
        .kv.kv-2col {
            display: grid;
            grid-template-columns: 3em 1fr 3em 1fr; /* PCは2列（dt dd dt dd） */
            column-gap: 10px;
            row-gap: 6px;
        }
            /* IE11フォールバックの解除（重要） */
            .kv.kv-2col dt,
            .kv.kv-2col dd {
                float: none;
                clear: none;
                width: auto;
                margin: 0;
                padding: 0;
                min-width: 0;
            }

            .kv.kv-2col dd {
                min-width: 0;
                white-space: nowrap; /* これは残してOK。不要なら削除可 */
            }

            .kv.kv-2col::after {
                content: none;
                display: none;
                clear: none;
            }
        /* スマホは1列に戻す（これを @supports の中に置くのがポイント） */
        @media (max-width: 520px) {
            .kv.kv-2col {
                grid-template-columns: 8.5em 1fr;
            }
        }
    }

    .enteral-bottom {
        margin-top: 10px;
    }
    /* === IE11向け：左右カラムの仕切り線（IEだけに出す） === */
    .layout > .main {
        border-right: 1px solid #ccc;
        padding-right: 12px;
    }

    .layout > .summary {
        padding-left: 12px;
    }
    /* === モダンでは線を消す（IEは@supports無視→線が残る） === */
    @supports (display: grid) {
        .layout > .main {
            border-right: 0;
        }

        .layout > .summary {
            padding-left: 0;
        }
    }
    /* BMR pills は常に1行に固定（モダン側で2行になるのを防ぐ） */
    .bmr-pills {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        gap: 6px;
        overflow: hidden; /* 収まらない分は隠す */
    }
        /* BMRのpillは縮められるようにする（trunc だけでも良いが、両方に効かせる） */
        .bmr-pills .pill {
            min-width: 0;
        }
            /* 算出法pillは省略（既にtrunc付与済みならこれで効く） */
            .bmr-pills .pill.trunc {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            /* 体重pillはできれば折り返さない（短いので通常は不要だが保険） */
            .bmr-pills .pill:not(.trunc) {
                white-space: nowrap;
            }
        /* BMR pillsだけ少し小さくして2行化を防ぐ */
        .bmr-pills .pill {
            font-size: 0.7em; /* 0.85〜0.92あたりで調整可 */
            line-height: 1.2;
            padding: 1px 6px; /* pillの高さも少し詰める（任意） */
        }
    /* カード見出しは途中改行しない */
    .card .section-head h3 {
        white-space: nowrap;
        word-break: normal;
        overflow-wrap: normal;
    }
    /* 見出し行：横並び基本 */
    .card .section-head {
        display: flex;
        align-items: baseline;
        gap: 10px;
    }
        /* 右側の長文は縮められるようにする（はみ出し防止） */
        .card .section-head .section-meta {
            min-width: 0;
            overflow-wrap: anywhere; /* はみ出しが気になるなら anywhere が確実 */
        }
    /* 中間幅から縦積み */
    @media (max-width: 1300px) {
        .card .section-head {
            flex-direction: column;
            align-items: flex-start;
        }
    }
    /* =========================
    IE用：カード間の仕切り
   （モダン側は @supports で無効化）
   ========================= */
    /* デバッグ用 outline が残っていたら消す */
    .card {
        outline: none !important;
    }
    /* IE用：カードの区切り（上線＋間隔） */
    .main .card,
    .summary .card {
        border-top: 1px solid #d6d6d6;
        margin-top: 8px;
    }

    @supports (display: grid) {
        .main .card,
        .summary .card {
            border-top: 0;
            margin-top: 0;
        }

            .main .card:first-of-type {
                border-top: 0;
                margin-top: 0;
            }
    }


    .main .card:first-of-type {
        background: #fffae6;
    }
    /* 性別：select の右にチェックを並べる */
    .inline-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: nowrap;
    }

    .inline-check {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
    }
    /* IE(IEモード) は flex gap 非対応なので margin で間隔を作る */
    .inline-controls > * {
        margin-right: 10px;
    }

        .inline-controls > *:last-child {
            margin-right: 0;
        }
    /* checkbox内の gap も IE 用に */
    .inline-check > input {
        margin-right: 6px;
    }

    @supports (gap: 10px) {
        .inline-controls > * {
            margin-right: 0;
        }

        .inline-check > input {
            margin-right: 0;
        }
    }
    /* === smartphone overflow fix === */
    *, *::before, *::after {
        box-sizing: border-box;
    }

    .field .control,
    .section-head .section-meta,
    .pills,
    .kv dd {
        min-width: 0;
    }
        /* 画面からはみ出さないよう max-width は全デバイスで効かせる */
        .field .control select,
        .field .control input,
        .field .control textarea {
            max-width: 100%;
        }

    @media (max-width: 520px) {
        /* ストレス係数など：はみ出さないように折り返す */
        .pills {
            flex-wrap: wrap;
        }
        /* ただしBMRだけは1行固定 */
        .bmr-pills {
            flex-wrap: nowrap;
        }
    }
    /* モダン/スマホでもカードの区切り線を出す（末尾で確実に上書き） */
    .main .card,
    .summary .card {
        border-top: 1px solid #d6d6d6;
        margin-top: 0px; /* カード間の隙間 */
    }
    /* 1カラム時：IE用の列仕切り（border/padding）が main に残ると左列だけ細く見えるため強制解除 */
    @media (max-width: 980px) {
        .main {
            border-right: 0 !important;
            padding-right: 0 !important;
            margin-right: 0 !important;
        }
        /* 念のため左右も揃える */
        .main, .summary {
            padding-left: 0 !important;
            margin-left: 0 !important;
        }
    }

    details.fold > summary {
        list-style: none; /* Firefox */
        cursor: pointer;
    }

        details.fold > summary::-webkit-details-marker {
            display: none; /* Chrome/Safari */
        }

        details.fold > summary::before {
            content: "▶";
            display: inline-block;
            margin-right: 6px;
            transform: rotate(0deg);
            transition: transform 0.15s ease;
        }

    details.fold[open] > summary::before {
        transform: rotate(90deg);
    }

/* === Bootstrap navbar：IE11対策（flex-gap非対応） === */
.navbar-nav .nav-item {
    margin-right: 12px;
}

    /* 最後の項目は余白不要 */
    .navbar-nav .nav-item:last-child {
        margin-right: 0;
    }

.navbar-brand {
    margin-right: 16px;
}

/* スマホでは「エネルギー候補（参考）」を完全に非表示 */
@media (max-width: 720px) {
    details.fold.energy-candidates {
        display: none;
    }
    .card-energy .hr {
        display: none;
    }
}
/* スマホ時はヘッダーを消す */
@media (max-width: 720px) {
    .appbar-header {
        display: none;
    }

    body {
        padding-top: 0;
    }
}

/* =========================
   Footer (appbar-footer)
   ========================= */
/* フッター全体 */
.appbar-footer {
    padding: 8px 0;
    border-top: 1px solid rgba(0,0,0,.12);
    margin-top: 12px;
}

    /* フッター内容（brand） */
    .appbar-footer .brand {
        display: flex;
        flex-wrap: wrap; /* 基本は自然折り返し */
        align-items: center;
        gap: 8px 12px;
        min-width: 0; /* はみ出し保険 */
        opacity: 0.75;
    }

    /* アイコン */
    .appbar-footer .brand-icon {
        width: 18px;
        height: 18px;
        object-fit: contain;
        display: inline-block;
    }

    /* ブランド一式（TNTCalculator / Ver / by） */
    .appbar-footer .brand-meta-inline {
        font-size: 12px;
        color: #667;
        white-space: nowrap; /* ブランドは基本1塊で */
        min-width: 0;
    }

    /* リンク（公式一覧 / 院内マニュアル） */
    .appbar-footer .brand-link {
        font-size: 13px;
        /* color: #667; */
        /* text-decoration: none; */
        margin-left: 0; /* gap で間隔管理（重複防止） */
        white-space: normal; /* 狭ければ自然に折り返す */
    }

    /* Privacyリンク */
    .appbar-footer .footer-privacy {
        white-space: normal; /* フッターなので複数行OK（重なり防止優先） */
    }

        /* PCで分かりやすく（太字＋下線） */
        .appbar-footer .brand-link:hover,
        .appbar-footer .footer-privacy:hover,
        .appbar-footer .brand-link:focus,
        .appbar-footer .footer-privacy:focus {
            text-decoration: underline;
            font-weight: bold;
        }

    /* スマホ/モダンで下線の見え方を統一（IE11/IEモードでは効かないが許容） */
    .appbar-footer a {
        text-underline-offset: 2px;
        text-decoration-thickness: 1px;
    }


    /* 右寄せ用スペーサ（使うなら） */
    .appbar-footer .footer-spacer {
        flex: 1 1 auto;
    }

/* スマホ帯：自然折り返し（1行に粘らない） */
@media (max-width: 520px) {
    .appbar-footer .brand {
        justify-content: flex-start; /* space-between をやめる＝重なり防止 */
        gap: 6px 10px;
    }

    .appbar-footer .footer-spacer {
        display: none; /* 狭幅では邪魔になりやすいので消す */
    }
}

/* =========================
   IE11 / IE mode
   ========================= */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {

    /* 横スクロール封じ込め（IE特有のはみ出し対策） */
    .appbar-footer {
        overflow-x: hidden;
    }

        /* IEは flex-gap 非対応があるので block + inline-block にする */
        .appbar-footer .brand {
            display: block;
            max-width: 100%;
            box-sizing: border-box;
        }

        .appbar-footer .footer-spacer {
            display: none; /* IEは右寄せ暴れやすいので無効化 */
        }

        .appbar-footer .brand > * {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 6px;
            vertical-align: middle;
        }

            .appbar-footer .brand > *:last-child {
                margin-right: 0;
            }

        /* 画像保険 */
        .appbar-footer img {
            max-width: 100%;
            height: auto;
        }

        /* アイコンの左余白（IEでも効かせる） */
        .appbar-footer .brand-icon {
            margin-left: 8px;
        }
}

/* スマホ：result-details / enteral-details の “一瞬openで描画” を隠してからJSで表示 */
@media (max-width: 980px) {
    html:not(.tnt-ready) details.result-details,
    html:not(.tnt-ready) details.enteral-details {
        visibility: hidden;
    }
}

/* ヘルプ用 */
.help-content img {
    max-width: 100%;
    height: auto;
}
.help-section-title {
    margin-top: 1.2em;
}